Kiwi TCMS 6.0
#############

:headline: security upgrade and removal of environment properties
:date: 2018-10-04 12:45
:comments: true
:tags: releases


We're happy to announce Kiwi TCMS version 6.0! This release
introduces new database migrations, removal of
environment properties in favor of tags, internal updates and bug fixes.
You can explore everything at
`https://public.tenant.kiwitcms.org <https://public.tenant.kiwitcms.org/login/github/>`_.


This release removes squashed migrations. Direct upgrades from versions
< 5.3.1 to 6.0 will break without an intermediate upgrade to 5.3.1!

Docker images::

    kiwitcms/kiwi       latest  cd087297f349    991.3 MB


Changes since Kiwi TCMS 5.3.1
-----------------------------


Improvements
~~~~~~~~~~~~

- Update to `Django 2.1.2 <https://docs.djangoproject.com/en/2.1/releases/2.1.2/>`_
  due to high severity security issue
- Update to `Patternfly 3.54.8 <https://github.com/patternfly/patternfly/releases>`_
- ``Tag`` objects are now shown in Admin panel
- Add autocomplete when adding tags to ``TestRun`` via UI


Removed functionality
~~~~~~~~~~~~~~~~~~~~~

- TestCase new and edit views no longer allow editing of tags. Tags can be
  added/removed from the Tags tab which also makes sure to properly account
  for permissions
- Remove ``EnvGroup``, ``EnvProperty`` and ``EnvValue`` models in favor of tags.
  Existing values and properties are converted into tags and automatically added
  to test runs!
- Convert squashed database migrations to regular ones and remove older migrations.
  **WARNING:** upgrade from versions <= 5.3.1 to 6.0 will break without an intermediate
  upgrade to ``kiwitcms/kiwi:5.3.1 a420465852be``.
- Remove deprecated ``TestCase.estimated_time`` and ``TestRun.estimated_time``. Fixes
  `Issue #514 <https://github.com/kiwitcms/Kiwi/issues/514>`_


Backend API
-----------

- No longer use ``product_version`` for ``TestRun.create``. Fixes
  `Issue #522 <https://github.com/kiwitcms/Kiwi/issues/522>`_

  - 'product' is no longer required
  - 'product_version' is no longer required
  - 'manager' and 'default_tester' can be usernames or IDs

- ``TestCase.create`` no longer accepts 'tag' values
- ``TestRun.add_tag`` and ``TestRun.remove_tag`` now return list of tags.
  Previously these methods returned ``None``!
  This is the list of tags assigned to the TestRun that is being modified!


Bug fixes
~~~~~~~~~

- Fix mismatched HTML tag in ``plan/get.html`` template (Oleg Kainov)
- Don't use ``|slugify`` filter in templates which breaks HTML links with non-ASCII
  TestPlan names. Fixes
  `Sentry KIWI-TCMS-38 <https://sentry.io/open-technologies-bulgaria-ltd/kiwi-tcms/issues/676626096/>`_


Refactoring
~~~~~~~~~~~

- Fix pylint errors (Ivaylo Ivanov, Anton Sankov)
- Use existing JSON-RPC methods to add/remove tags via webUI and remove specialized
  backend methods that handled these requests. Also make sure to obey respective
  permissions


Translations
~~~~~~~~~~~~

- Updated `Slovenian translation <https://crowdin.com/project/kiwitcms/sl#>`_


How to upgrade
---------------

If you are using Kiwi TCMS as a Docker container then::

    cd Kiwi/
    git pull
    docker-compose down
    docker pull kiwitcms/kiwi
    docker pull centos/mariadb
    docker-compose up -d
    docker exec -it kiwi_web /Kiwi/manage.py migrate

Don't forget to `backup <{filename}2018-07-30-docker-backup.markdown>`_
before upgrade!


Subscription based online service
---------------------------------

We are planning to convert
`https://public.tenant.kiwitcms.org <https://public.tenant.kiwitcms.org/login/github/>`_ into
a subscription based service for people who don't want to bother installing
Kiwi TCMS on their own systems and just want to use it for test collaboration
with their team.

The income from this service will go towards covering operating costs and
supporting the
`development team <https://github.com/orgs/kiwitcms/people>`_. Watch this
blog for further announcements about this. Meanwhile you may share your
thoughts via
`Issue #515 <https://github.com/kiwitcms/Kiwi/issues/515>`_.


Plans to remove deprecated functionality
----------------------------------------

``TestRun.product_version`` will be removed from the database schema in favor of
``TestRun.plan.product_version``! With the latest web interface it is not possible
to select a product version different than the one selected in the Test Plan.
Test runs should only be able to select product builds (after
`Issue #246 <https://github.com/kiwitcms/Kiwi/issues/246>`_ is fixed).
